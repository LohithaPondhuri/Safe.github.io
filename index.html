<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>World Map with Safe Areas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }
    #map {
      height: 100%;
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Initialize map
    var map = L.map('map', { zoomControl: true }).setView([20, 0], 2);

    // Add world tiles
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
      noWrap: true,
      bounds: [[-90, -180], [90, 180]],
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Function to generate random points within radius (km)
    function generateRandomPoints(center, numPoints, radiusKm) {
      let points = [];
      for (let i = 0; i < numPoints; i++) {
        let radius = Math.random() * radiusKm / 111; // 1° ≈ 111 km
        let angle = Math.random() * Math.PI * 2;
        let lat = center.lat + radius * Math.cos(angle);
        let lng = center.lng + radius * Math.sin(angle);
        points.push([lat, lng]);
      }
      return points;
    }

    // Locate user
    map.locate({ setView: true, maxZoom: 10 });

    // When location is found
    map.on('locationfound', function(e) {
      // Mark user location
      L.marker(e.latlng).addTo(map)
        .bindPopup("📍 You are here").openPopup();

      // Draw a 50 km radius circle
      L.circle(e.latlng, {
        radius: 50000, // 50 km in meters
        color: "green",
        fillOpacity: 0.1
      }).addTo(map);

      // Generate random safe areas (green)
      let safeAreas = generateRandomPoints(e.latlng, 10, 50); 
      safeAreas.forEach((spot, i) => {
        L.circleMarker(spot, {
          radius: 8,
          color: "green",
          fillColor: "green",
          fillOpacity: 0.8
        }).addTo(map)
          .bindPopup("✅ Safe Area #" + (i+1));
      });
    });

    // If location not found
    map.on('locationerror', function() {
      alert("Unable to access your location. Please allow location access.");
    });
  </script>
</body>
</html>
